{% extends "base.html" %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/countryprofilestyles.css') }}">
    <title>Country Profile - Parkour Progress</title>
{% endblock %}

{% block content %}
    <div id="main-container">
        <div id="search-container">
            <div id="search-bar">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input type="text" placeholder="Enter country" autocomplete="off" id="search-input">
                <div id="suggestions-container"></div>
            </div>
        </div>
        {% if data is not none %}
            {% if data['Stats']['Players'] is not none %}
                <div id="profile-container">
                    <div id="country-title-container">
                        <img class="flag" src="{{ url_for('static', filename=flags[data['Stats']['Code']]) }}" alt="{{ flag }}">
                        <span>{{ data['Stats']['Name'] }}</span>
                    </div>

                    <div id="players-container">
                        <div id="players-header-container">
                            <span id="players-header-text">Players</span>
                            <div class="info-icon">
                                i
                                <div class="popup">
                                    <span>
                                        Currently sorted by number of maps completed, will likely be changed when the ranking system is implemented.
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div id="players-list-container">
                            {% for player in data["Stats"]["Players"] %}
                                <div class="player-container" onclick="redirectToPlayerPage('{{ player['ID'] }}')">
                                    <img src="https://vzge.me/face/{{ player["Name"] }}" class="player-face">
                                    {{ player["Name"] }}
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div id="stats-container">
                        <div class="stat-container">
                            <img src="{{ url_for('static', filename='images/icon-players.png') }}"/>
                            <div class="stat-title">
                                <span>Players</span>
                                <span class="stat-number">{{ data['Stats']['PlayerCount'] }}</span>
                            </div>
                            <div class="stat-rankings">
                                <span class="stat-rankings-1"><strong>{{ data['Stats']['PlayerCountPercent'] }}%</strong> of all players</span>
                                <span class="stat-rankings-2"><strong>#{{ data['Stats']['PlayerCountPosition'] }}</strong> global</span>
                            </div>
                        </div>
                        <div class="stat-container">
                            <img src="{{ url_for('static', filename='images/icon-trophy.png') }}"/>
                            <div class="stat-title">
                                <span>Map completions</span>
                                <span class="stat-number">{{ data['Stats']['Completions'] }}</span>
                            </div>
                            <div class="stat-rankings">
                                <span class="stat-rankings-1"><strong>{{ data['Stats']['CompletionsPercent'] }}%</strong> of all completions</span>
                                <span class="stat-rankings-2"><strong>#{{ data['Stats']['CompletionsPosition'] }}</strong> global</span>
                            </div>
                        </div>
                        <div class="stat-container">
                            <img src="{{ url_for('static', filename='images/icon-fails.svg') }}"/>
                            <div class="stat-title">
                                <span>Sky fails</span>
                                <span class="stat-number">{{ data['Stats']['Fails'] }}</span>
                            </div>
                            <div class="stat-rankings">
                                <span class="stat-rankings-1"><strong>{{ data['Stats']['FailsPercent'] }}%</strong> of all sky fails</span>
                                <span class="stat-rankings-2"><strong>#{{ data['Stats']['FailsPosition'] }}</strong> global</span>
                            </div>
                        </div>
                    </div>

                    <div id="maps-container">
                        <div id="maps-header-container">
                            <p>Maps</p>
                        </div>
                        <div id="maps-list-container">
                            {% for map in data['Maps'] %}
                                <div class="map-container" onclick="redirectToMapPage('123')">
                                    <div class="map-field map-title">
                                        <div class="map-name">{{ map['MapName'] }}</div>
                                    </div>
                                    <div class="map-field map-type">
                                        <div class="map-gamemode">{{ map['Gamemode'] }}</div>
                                        <div class="map-status">{{ map['List'] }}</div>
                                    </div>
                                    <div class="map-field map-status">
                                        {% if map['Type'] == 'Victor' %}
                                            <div class="map-status-beaten-by">
                                                <div>Beaten by</div>
                                                <div class="player-card" onclick="redirectToPlayerPage(event, '123')">
                                                    <img src="https://vzge.me/face/{{ map['Player'] }}" class="player-face" alt="Texyle"/>
                                                    <div>{{ map['Player'] }}</div>
                                                </div>
                                            </div>
                                            <div class="map-status-date">
                                                <div>on {{ map['Date'] }}</div>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="map-field map-image-container">
                                        {% set map_name = map['MapName']|to_filename %}
                                        {% set map_name = map_name ~ '_small' %}
                                        {% set filename = map_images[map_name] %}
                                        <img class="map-image" loading="lazy" src="{{ url_for('static', filename=filename) }}" alt="{{ map['MapName'] }}">
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
            </div>
            {% else %}
                <div id="profile-container-empty">
                    <div id="country-title-container">
                        <img class="flag" src="{{ url_for('static', filename=flags[data['Stats']['Code']]) }}" alt="{{ flag }}">
                        <span>{{ data['Stats']['Name'] }}</span>
                    </div>
                    <div id="empty-container">
                        <div class="wave-container">
                            <h1 class="wave-text">
                                <span>E</span><span>M</span><span>P</span><span>T</span><span>Y</span>
                            </h1>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% else %}
            reminder for myself to do something with this blank box (go search for a country)
        {% endif %}
    </div>

    <script>
        var countries = {{ countries | tojson }};
        const flags = {{ flags | tojson }}
    </script>
    <script src="{{ url_for('static', filename='js/countryprofile.js') }}"></script>
{% endblock %}